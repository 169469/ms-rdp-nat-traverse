<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>微软远程桌面——内网穿透助手 by ChrisLeeGit</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">微软远程桌面——内网穿透助手</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/ChrisLeeGit/MSRDPNatTraverse" class="btn">View on GitHub</a>
      <a href="https://github.com/ChrisLeeGit/MSRDPNatTraverse/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/ChrisLeeGit/MSRDPNatTraverse/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="微软远程控制-内网穿透助手" class="anchor" href="#%E5%BE%AE%E8%BD%AF%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%8A%A9%E6%89%8B" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>微软远程控制 内网穿透助手</h1>

<hr>

<h2>
<a id="说明" class="anchor" href="#%E8%AF%B4%E6%98%8E" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>说明</h2>

<ul>
<li>一般来说，同在一个局域网下的两个Windows计算机可以正常使用微软的远程桌面实现远程登录。但是，当两台计算机网络环境相对复杂，尤其是不在同一局域网下，就需要使用别的手段来实现访问了。</li>
<li>本方案就是使用SSH连接到远程代理服务器，建立SSH反向隧道的方式实现无论在何种网络环境下，只要代理服务器工作正常，并且双方均可以与服务器正常交互，便可借助本客户端实现轻松实现远程控制。</li>
<li>应用开发分为客户端软件开发和服务器软件开发。</li>
</ul>

<h2>
<a id="简要工作原理" class="anchor" href="#%E7%AE%80%E8%A6%81%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>简要工作原理</h2>

<ul>
<li>在客户端中选中要进行远程控制的目标主机，在连接后，目标主机会收到远程控制请求；目标主机会自动建立反向隧道，将远程桌面端口(默认<code>3389</code>)映射到远程服务器的随机端口中。</li>
<li>由于使用了随机分配的隧道端口，并且，端口号不是常用的，相对比较安全（寡人是这么认为的）；况且本地在完成控制后，目标主机也会自动断开隧道。</li>
</ul>

<h2>
<a id="pc客户端软件" class="anchor" href="#pc%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PC客户端软件</h2>

<ul>
<li>客户端软件使用Visual C#开发，运行在.Net 4.5及以上平台的系统上，理论上支持Windows 7及以上系统，但是要确保.Net版本符合要求，否则无法运行本客户端。</li>
<li>客户端实现中，借助于<code>plink.exe</code>（即<code>putty.exe</code>）的命令行版本实现免密码输入，建立反向SSH隧道的功能。</li>
<li>客户端提供的功能说明：

<ul>
<li>
<strong>注册</strong>：客户端在启动后，点击"启动"按钮，客户端会自动尝试与代理服务器联系，并获取ID，同时在代理服务器上存储自身的信息；完成“注册”过程；</li>
<li>
<strong>远程列表</strong>: 在“远程”页面中，点击“更新”按钮，可以拿取目前在线注册的计算机列表，将提供计算机ID和名称的显示；</li>
<li>
<strong>连接/断开</strong>: 本机可以选择远程主机，点击“连接”按钮后申请远程控制；当完成控制后，可以点击“断开”按钮，要求远程主机关闭隧道。</li>
</ul>
</li>
<li>主要使用到的第三方库：<a href="https://github.com/JamesNK/Newtonsoft.Json">Newtonsoft.json</a>，有关该库的<code>license</code>请参见<code>Licese</code>目录</li>
</ul>

<h2>
<a id="mac客户端软件" class="anchor" href="#mac%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mac客户端软件</h2>

<ul>
<li>客户端基于<code>PyQt-5.5.1</code>使用<code>Python 3.5</code>开发，经过测试，基本功能正常；</li>
<li>Mac客户端仅支持远程请求连接开放连接权限的主机；</li>
<li>Mac客户端不支持Windows下的被远程控制的功能，仅仅是为了配合Mac下的<code>Microsoft Remote Desktop</code>软件实现内网穿透访问其他远程计算机。</li>
</ul>

<h2>
<a id="服务器软件" class="anchor" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AF%E4%BB%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>服务器软件</h2>

<ul>
<li>服务器端采用了<code>Python 3</code>开发；</li>
<li>新版本使用了<a href="https://twistedmatrix.com/trac/">Twisted 16</a>框架重新编写部分代码，增强了服务器端的稳定性；</li>
<li>服务器端程序会在启动后自动在指定端口（默认为9000）进行监听，并及时处理来自客户端的请求；</li>
<li>服务器端在运行前，可以在配置文件中更改日志文件名称，以及输出日志的等级；默认日志等级为<code>DEBUG</code>。日志等级可以选择的项目包括：

<ul>
<li><code>DEBUG</code></li>
<li><code>INFO</code></li>
<li><code>ERROR</code></li>
<li><code>WARN</code></li>
</ul>
</li>
</ul>

<h2>
<a id="如何运行" class="anchor" href="#%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>如何运行</h2>

<h3>
<a id="服务器端程序" class="anchor" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E7%A8%8B%E5%BA%8F" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>服务器端程序</h3>

<ol>
<li>确保在服务器系统上（我使用的是<code>Cent OS 7</code>)已经成功安装了<code>Python 3</code>尽可能新的版本</li>
<li>确保在服务器系统上为<code>Python 3</code>安装了<code>Twisted 16.0</code>相关模块，服务器程序依赖此库</li>
<li>将<code>ProxyServer</code>的代码全部放置在某个目录下，如<code>ProxyServer</code>目录，使用<code>python3 server.py</code>即可运行</li>
<li>可以在config文件中修改相关设置，根据需要修改</li>
</ol>

<h3>
<a id="pc客户端软件-1" class="anchor" href="#pc%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PC客户端软件</h3>

<ol>
<li>请在<a href="https://github.com/ChrisLeeGit/MSRDPNatTraverse/releases">这儿</a>下载最新发布的<code>Realse</code>版本，将<code>RAR</code>格式的压缩包下载到电脑上，并解压；</li>
<li>确保在Windows系统上安装了<code>.Net 4.5</code>及以上版本，双击即可运行软件；</li>
<li>在运行后，需要根据需要配置代理服务器以及本机的设置，然后才可以点击启动按钮启动相关服务。其他功能比较简单，很容易使用；</li>
<li>客户端运行截图：

<ul>
<li><img src="https://raw.githubusercontent.com/ChrisLeeGit/MSRDPNatTraverse/master/ScreenShots/win7_1.jpg" alt="截图0"></li>
<li><img src="https://raw.githubusercontent.com/ChrisLeeGit/MSRDPNatTraverse/master/ScreenShots/win10_1.jpg" alt="截图1"></li>
<li><img src="https://raw.githubusercontent.com/ChrisLeeGit/MSRDPNatTraverse/master/ScreenShots/win10_2.jpg" alt="截图2"></li>
<li><img src="https://raw.githubusercontent.com/ChrisLeeGit/MSRDPNatTraverse/master/ScreenShots/win10_3.jpg" alt="截图3"></li>
</ul>
</li>
</ol>

<h3>
<a id="mac客户端软件-1" class="anchor" href="#mac%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Mac客户端软件</h3>

<ol>
<li>确保<code>PyQt-5</code>已经在Mac上安装成功；</li>
<li>确保<code>Python 3</code>在Mac上安装成功；</li>
<li>下载Mac版客户端代码，解压后在终端中进入解压后的目录，使用命令：<code>python3 App.py</code>即可运行；</li>
<li>请确保下载了微软远程桌面软件(<code>Microsoft Remote Desktop</code>)，然后才能借助于客户端穿透内网访问其他远程计算机；</li>
<li>客户端运行截图：

<ul>
<li><img src="https://raw.githubusercontent.com/ChrisLeeGit/MSRDPNatTraverse/master/ScreenShots/mac_1.png" alt="截图1"></li>
<li><img src="https://raw.githubusercontent.com/ChrisLeeGit/MSRDPNatTraverse/master/ScreenShots/mac_2.png" alt="截图2"></li>
</ul>
</li>
</ol>

<h2>
<a id="许可" class="anchor" href="#%E8%AE%B8%E5%8F%AF" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>许可</h2>

<ul>
<li>本项目为个人业余项目，算不上专业，代码组织的也不是特别好，还在进一步学习改进中。所有本人编写的源码采用<code>MIT LICENSE</code>。</li>
<li>Enjoy~</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/ChrisLeeGit/MSRDPNatTraverse">微软远程桌面——内网穿透助手</a> is maintained by <a href="https://github.com/ChrisLeeGit">ChrisLeeGit</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
